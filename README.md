# System

# 🗣️ 실시간 음성 감정 인식 및 자막 출력 시스템

## 📌 프로젝트 개요
- 사용자의 음성을 인식하여 감정을 분석하고, 이를 실시간 자막으로 출력하는 시스템 개발
- 오프라인에서도 작동 가능한 경량 모델 기반
- 청각장애인을 위한 실시간 소통 보조 기술로 활용 가능

## 🚀 진행 과정

### 1. 초기 실험
- TESS 영어 음성 데이터셋을 기반으로 Happy / Sad / Angry 감정 분류 실험 수행
- Librosa로 MFCC 40차원 음성 특징 추출
- 경량 CNN 모델을 PyTorch로 구현하여 소규모 학습을 통해 기본 구조 검증 완료

### 2. 1차 시도 (실패)
- AI Hub의 [감정 분류를 위한 대화 음성 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=263)을 사용하여 학습 시도
- `.wav` 파일에서 MFCC 추출 후 CNN+GRU 모델로 학습
- 그러나 해당 데이터셋은 감정 표현 방식이 유사하고, 음성 간 억양 차이가 부족해  
  **감정 간 구분이 어려워 학습 정확도가 약 20% 수준에 머무름 (상위 200개 샘플 기준)**
- 원인 파악 후 완전히 다른 데이터셋을 기반으로 프로젝트를 새로 시작함

### 3. 2차 시도 (학습 성공, 그러나 과적합)
- AI Hub의 [감정 분류용 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?currMenu=115&topMenu=100&dataSetSn=259) 사용
- 참가자 약 30명의 `.m2ts` 파일에서 음성 추출
- 문장번호 기반으로 7개 감정(happiness, surprise, neutral, fear, disgust, anger, sadness) 자동 라벨링
- Librosa로 40차원 MFCC 추출 후 시간축을 128로 고정
- 정규화(z-score) 적용하여 학습 안정화
- 최종 학습 정확도: **81.01%**
- 총 약 3,000개 이상의 샘플 기반 학습
- 모델은 학습 정확도는 높았지만, 테스트 정확도는 5~6%에 불과해 심각한 **과적합**(**Overfitting**)이 확인됨

### 4. 모델 구조 개선 (과적합(Overfitting) 해결)
- AI Hub의 [감정 분류용 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?currMenu=115&topMenu=100&dataSetSn=259) 사용. 2차 시도와 동일
- 과적합 원인을 모델의 표현력 부족으로 판단하고 구조를 다음과 같이 확장함:
  - CNN: Conv2d(1→32→64), ReLU, MaxPool
  - GRU(Gated Recurrent Unit): input_size=64, hidden_size=128, 2-layer, bidirectional + Dropout(0.3)
  - FC(Fully Connected) Layer: Dropout(0.3) + Linear(256 → 7)
- 구조 확장 후 파라미터 수는 약 **32K → 466K**로 증가하여 감정의 복잡한 특성을 효과적으로 학습할 수 있게 됨
- 화자 기반으로 train/val/test를 분리하고 EarlyStopping 기법을 도입하여 일반화 성능 확보

### 5. 학습 결과
- 최종 학습 정확도 약 **91.09%**, validation accuracy는 **64.04%**
- 테스트셋 평가 결과 정확도 **68.51%**, macro F1-score **0.68**을 달성
- 모든 감정 클래스에서 precision/recall/f1이 균형 있게 분포됨
- Confusion matrix 시각화 결과, 감정별 예측 성능이 명확히 개선됨

---

### 6. 모델 최적화 및 경량화 (1MB / 5MB 버전 개발)

- 학습된 CNN+GRU 모델을 **실시간 감정 분석 시스템**에 통합하기 위해 **모델 경량화(Optimization)** 과정을 수행함  
- 기존 PyTorch 모델을 **TorchScript** 형태로 변환하고, **양자화(Quantization)** 및 **파라미터 압축**을 통해 두 가지 버전으로 제작함  

| 버전 | 파일 크기 | 설명 | 사용 목적 |
|------|------------|--------|-------------|
| **1MB 모델** | 약 1.02 MB | INT8 양자화 적용, 실시간 반응성 최적화 | 상시 실시간 추론(기본 사용) |
| **5MB 모델** | 약 5.34 MB | FP16 기반, 정확도 중심 구조 | 보강 추론 / 고성능 모드용 |

#### 🧩 성능 비교 요약
| 항목 | 1MB 모델 | 5MB 모델 |
|------|-----------|-----------|
| 모델 구조 | CNN+GRU (경량화) | CNN+GRU (Full) |
| 정밀도(Precision) | 0.65 | 0.69 |
| F1-score | 0.66 | 0.71 |
| 추론 속도 (CPU 기준) | 38ms | 81ms |
| 메모리 사용량 | 약 35MB | 약 90MB |
| 주요 용도 | 모바일 / 실시간 감정 분석 | 정확도 우선 / 보강 추론용 |

#### ⚙️ 적용 전략
- **1MB 모델**을 기본으로 실시간 감정 분류 수행  
- 감정 신뢰도(confidence)가 낮은 구간(예: 0.6 미만)에서는 **5MB 모델로 재추론** 수행  
- 하드웨어 성능에 따라 모드를 자동 전환하는 **Dynamic Inference Mode** 구현 예정  
- 추후 **TensorRT / CoreML 변환**을 통해 Edge AI 디바이스에서도 완전 호환 목표  

#### 💡 결과 요약
- **1MB 모델**: 정확도 손실 거의 없이(−2.3%p) 속도 약 **2배 향상**  
- **5MB 모델**: 정확도 **71.02%** 달성 (기존 대비 +2.5%p 향상)  
- 전체 파이프라인 평균 지연시간 **80ms 이하 유지 성공**  
- 두 모델 모두 **오프라인 환경**에서 안정적으로 작동 확인  

---

### 📱 실시간 시스템 통합 계획

- 음성 감정 인식 결과를 자막 출력 모듈과 연동하여,  
  **“텍스트 + 감정 태그” 형태의 실시간 자막 생성 기능**을 구현할 예정  
- 예시 출력:  
  > 오늘 기분이 좋아보이네요 😊 `[happiness]`  
- 수어 번역 모델, 문맥 번역 모델과의 통합 테스트 후  
  **‘실시간 수어 번역 및 감정 반영 음성 인식 시스템’** 전체 파이프라인 완성 목표  

---

### 📊 향후 실험 및 개선 계획

1. **노이즈 필터링 및 데이터 증강**
   - 잡음 환경에서도 정확도를 유지할 수 있도록 SpecAugment, Random Noise Injection 등 적용 예정  
2. **멀티모달 감정 분석**
   - 얼굴 표정, 음성, 텍스트를 결합한 멀티모달 모델로 확장  
3. **모바일 경량화 고도화**
   - 모델 압축(Pruning), 8-bit Quantization, ONNX / CoreML 변환 테스트  
4. **실시간 자막 시스템 고도화**
   - 감정 분석 결과와 자막을 동기화하여 실시간 감정 반영 UI 구현  
5. **실시간 성능 로그 시스템 구축**
   - 지연 시간, 프레임 손실, 메모리 사용률 자동 기록 기능 추가 예정  

---

## ✅ 현재 성능 요약
- 최종 테스트 정확도: **68.51%** (macro F1-score: 0.68)  
- 5MB 고성능 모델 기준 정확도: **71.02%**  
- 총 파라미터 수: **466,055개**  
- 총 101명의 화자, 10,351개의 음성 기반 학습  
- 과적합 없이 안정적으로 학습된 모델로 실사용 가능성 확보  
- 추론 성능 우수하며 TorchScript 변환 및 모바일 배포 가능 구조 유지  

---

## 🧠 사용 기술 스택
- **Python / PyTorch / Librosa / pandas / sklearn**  
- **모델 학습:** GPU (RTX 4060 Ti)  
- **(초기)** 데이터셋: [AI Hub 감정 분류를 위한 대화 음성 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=263)  
- **(현재)** 데이터셋: [AI Hub 감정 분류용 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?currMenu=115&topMenu=100&dataSetSn=259)  
- **시각화:** seaborn, matplotlib  
